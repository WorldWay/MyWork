<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sqkj.znyj.hisdao.CheckDao">
	<resultMap id="PDMap" type="com.sqkj.znyj.model.PD">
		<result column="YPBH" property="YPBH" />
		<result column="YPMC" property="YPMC" />
		<result column="XQ" property="XQ" />
		<result column="YPSL" property="YPSL" />
		<result column="isRight" property="isRight"/>
	</resultMap>
	<select id="getPDbyId" resultMap="PDMap" parameterType="java.util.Map">
		select * from
			(select b.YPBH as YPBH,b.YPMC as YPMC,b.XQ as XQ,sum(c.YWYPSL) as YPSL,a.isRight as isRight from sq_pm as a
				left join sq_ypxx as b on a.YPBH=b.YPBH 
				left join sq_ypyw as c on a.YPBH=c.YPBH
				where a.YPBH &lt;&gt; '' 
				group by b.YPBH,b.YPMC,b.XQ,a.isRight
			) as tab
		where tab.YPBH = #{YPBH}
	</select>
	<select id="getPDList" resultMap="PDMap" parameterType="java.util.Map">
		select * from (
		select top (#{length}) *
		 from (
		select top (#{start}+#{length}) * from 
		
		(select b.YPBH as YPBH,b.YPMC as YPMC,b.XQ as XQ,sum(c.YWYPSL) as YPSL,a.isRight as isRight from sq_pm as a
			left join sq_ypxx as b on a.YPBH=b.YPBH 
			left join sq_ypyw as c on a.YPBH=c.YPBH
			where a.YPBH &lt;&gt; '' 
			group by b.YPBH,b.YPMC,b.XQ,a.isRight
		) as tab
		
		where 1=1
		<if test="YPBH !=null &amp; YPBH!=''">
			and tab.YPBH = #{YPBH}
		</if>
		<if test="keywords != null">
			and tab.YPBH like '%${keywords}%'
		</if>
		order by tab.YPBH asc
		) as d order by d.YPBH desc
		) as e order by e.YPBH asc
	</select>
	<select id="getPDCount" resultType="int" parameterType="java.util.Map">
		select count(*) from 
		
		(select b.YPBH as YPBH,b.YPMC as YPMC,b.XQ as XQ,sum(c.YWYPSL) as YPSL,a.isRight as isRight from sq_pm as a
			left join sq_ypxx as b on a.YPBH=b.YPBH 
			left join sq_ypyw as c on a.YPBH=c.YPBH
			where a.YPBH &lt;&gt; '' 
			group by b.YPBH,b.YPMC,b.XQ,a.isRight
		) as tab
		 
		 where 1=1
		<if test="YPBH !=null &amp; YPBH!=''">
			and tab.YPBH = #{YPBH}
		</if>
		<if test="keywords != null">
			and  tab.YPBH like '%${keywords}%'
		</if>
	</select>
	<update id="updatePD" parameterType="java.util.Map">
		update SQ_PM set isRight = #{isRight} where PMDZ = #{PMDZ} and ZJQIP = #{ZJQIP}
	</update>
	<update id="resetPD" >
		update SQ_PM set isRight = '0'
	</update>
</mapper>